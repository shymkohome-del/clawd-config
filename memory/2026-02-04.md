# Session 2026-02-04 — CRYPTO_MARKET QA Testing

## Project: crypto_market Flutter App QA Testing

## Summary
Created automated QA test suite for crypto_market project. Encountered compilation issues in generated Flutter Driver code. Established strict orchestrator delegation rules in AGENTS.md.

## What Was Done

### 1. flutter-user-emulator Created QA Test Suite (9 UI Scenarios)

| Test ID | Category | Scenario | Status |
|---------|----------|----------|--------|
| SEC3 | Security | Price Oracle Manipulation — Verify UI shows locked prices | Created |
| SEC4 | Security | Dispute Flood Protection — Verify rate limiting warning | Created |
| SEC5 | Security | Signature Reuse Prevention — Verify nonce/hash display | Created |
| D1 | Dispute | Dispute with Evidence — Test image picker upload flow | Created |
| D2 | Dispute | Dispute Timeout — Verify timeout warning messages | Created |
| D3 | Dispute | Emergency Recovery — Test admin recovery UI screens | Created |
| D4 | Dispute | Partial Refund — Verify refund UI displays partial amounts | Created |
| P3 | Payment | Large Amount Flagging — Verify high-value transaction warnings | Created |
| P5 | Payment | Payment During Timeout — Test grace period UI messages | Created |

### 2. Test Files Created
- `/Users/vitaliisimko/clawd-flutter-user-emulator/run_qa_tests.sh`
- `/Users/vitaliisimko/clawd-flutter-user-emulator/README.md`
- `/Users/vitaliisimko/workspace/projects/other/crypto_market/crypto_market/test_driver/qa_9_scenario_test.dart`

### 3. Test Execution Attempt
- ❌ **Compilation errors** in generated Flutter Driver code:
  - `find.textContaining()` — method doesn't exist (should use `find.text()`)
  - `driver.isPresent()` — method doesn't exist (should use `driver.waitFor()`)
  - `jsonEncode(..., indent: 2)` — incorrect syntax
- Chrome not supported for integration tests
- macOS requires Xcode (not available in current environment)

### 4. AGENTS.md Updated — Strict Orchestrator Rules
**Commits:** `0c1b024`, `ed8569e`, `02353dc`, `4798333`, `c5c39be`

**Key Rules Established:**
- **Main Agent = Orchestrator ONLY** (not executor)
- **BEFORE crypto_market work:**
  1. Read `flutter-orchestrator.md`
  2. **Perfectly study** all rules (memorize, not just read)
  3. Embody the orchestrator role
  4. Then delegate to sub-agents
- **ABSOLUTE FORBIDDEN for Main Agent:**
  - Run Flutter tests → delegate to `flutter-user-emulator`
  - Compile project → delegate to `flutter-dev`/`flutter-dev-ui`
  - ICP operations → delegate to `icp-backend-specialist`
  - Terminal commands without context → use sub-agents

### 5. Session Handoff Script Updated
- Added auto-cleanup of old handoff files
- Only ONE handoff file kept at a time
- Prevents accumulation of handoff files

## Project Location
`/Users/vitaliisimko/workspace/projects/other/crypto_market/`

## Flutter Path
`/Users/vitaliisimko/flutter/bin/flutter`

## Critical Safety Files (READ BEFORE WORK)
- `memory/CRYPTO_MARKET_SAFETY_VAULT.md` — Canister IDs, ic_user identity
- `memory/ENVIRONMENT_SAFETY_MANIFEST.md` — Environment zones
- `memory/AGENT_SAFETY_GUIDELINES.md` — Blockchain operations

## Agent Rules Files
- `_bmad/my-custom-agents/agents/flutter-orchestrator/flutter-orchestrator.md` — MUST READ FIRST
- `_bmad/my-custom-agents/agents/flutter-user-emulator/flutter-user-emulator.md`
- `_bmad/my-custom-agents/agents/flutter-dev/flutter-dev.md`
- `_bmad/my-custom-agents/agents/icp-backend-specialist/icp-backend-specialist.md`

## Handoff File
`/Users/vitaliisimko/clawd/memory/HANDOFF-SESSION-20260204-202454.md` (auto-deletes old ones)

## Next Steps
1. Fix compilation errors in `qa_9_scenario_test.dart`:
   - Replace `textContaining` with `text` or `byValueKey`
   - Replace `isPresent` with `waitFor`
   - Fix `jsonEncode` syntax
2. Run tests via flutter-user-emulator on macOS
3. Review test results
