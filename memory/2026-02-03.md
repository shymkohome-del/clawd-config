# Session: 2026-02-03 21:43 UTC

- **Session Key**: agent:main:main
- **Context**: Transformed into flutter-orchestrator for crypto_market project

## Key Events

### 1. Flutter Orchestrator Transformation Complete
Successfully embodied **Maestro Coordinator** persona for crypto_market project.

**Core responsibilities:**
- Task orchestration via semantic analysis and strategic planning
- Coordination of 5 sub-agents: amos, flutter-dev, flutter-dev-ui, icp-backend-specialist, flutter-user-emulator
- Enforcement of safety protocols for ICP mainnet operations
- Execution of autonomous workflows (DR/AR commands)

### 2. Critical Safety Protocols Learned

**Production Canister IDs (NEVER TOUCH WITHOUT APPROVAL):**
- atomic_swap: 6p4bg-hiaaa-aaaad-ad6ea-cai
- marketplace: 6b6mo-4yaaa-aaaad-ad6fa-cai
- user_management: 6i5hs-kqaaa-aaaad-ad6eq-cai
- price_oracle: 6g7k2-raaaa-aaaad-ad6fq-cai
- messaging: 6ty3x-qiaaa-aaaad-ad6ga-cai
- dispute: 6uz5d-5qaaa-aaaad-ad6gq-cai
- performance_monitor: 652w7-lyaaa-aaaad-ad6ha-cai

**ic_user Identity (SACRED):**
- Principal: 4gcgh-7p3b4-gznop-3q5kh-sx3zl-fz2qd-6cmhh-gxdd6-g6agu-zptr7-kqe
- Controls ALL production canisters
- NEVER delete, NEVER share, always verify before use

**FORBIDDEN Actions:**
1. Delete ic_user identity
2. Use default identity for mainnet
3. Run raw `dfx deploy --network ic`
4. Modify canister_ids.json manually
5. Delete .dfx/ic/ directory
6. Hardcode canister IDs in code
7. Mix .env files between environments
8. Deploy to mainnet without –í—ñ—Ç–∞–ª—å–æ–Ω approval

### 3. Autonomous Protocol Workflow

**DR (Develop-Review) / AR (Autonomous-Review) commands:**
- Entry ‚Üí Load State ‚Üí Completion Check ‚Üí [Loop until 100%]
- Task lifecycle: NEEDS_DEV ‚Üí NEEDS_REVIEW ‚Üí NEEDS_QA ‚Üí VERIFIED
- QA PASSED signal from flutter-user-emulator is MANDATORY
- Self-healing on errors, no user questions during autonomous mode

### 4. Flutter Driver MCP Guide (Proven Method)

**5 Critical Validation Rules:**
1. Profile Mode ‚Äî always `--profile` on macOS
2. Separate Entrypoint ‚Äî `lib/main_driver.dart`, never `main.dart`
3. Initialization Order ‚Äî `enableFlutterDriverExtension()` FIRST
4. Wait for DTD ‚Äî `--print-dtd`, wait for "ws://..."
5. ScreenUtil Safety ‚Äî MUST wrap in `ScreenUtilInit`

### 5. /RUN PROTOCOL (BMAD Deployment Workflow)

**Location:** `_bmad/my-custom-agents/workflows/run/`

**Purpose:** Automated deployment and launch workflow for Crypto Market Flutter/ICP application

**7-Step Workflow:**

#### Step 1: Environment Selection (`step-01-env-select.md`)
- Parse CLI argument (local/staging/production)
- Normalize aliases: dev‚Üílocal, stage/stg‚Üístaging, prod/ic/mainnet‚Üíproduction
- Set ENVIRONMENT, NETWORK, FLAVOR
- Save checkpoint to `_bmad/_memory/run-checkpoint.yaml`
- **Auto-proceed** to Step 2

#### Step 2: Pre-flight Checks (`step-02-preflight.md`)
- **SAFETY CHECK** for mainnet (ic): Run `safety-check.sh`
- Verify: dfx installed, flutter installed, project structure valid
- Check: jq, node.js, wallet balance, dfx version
- **IPFS daemon** (local only): Auto-start if not running
- **Auto-proceed** to Step 3

#### Step 3: DFX Status Management (`step-03-dfx-status.md`)
- **Smart Detection**: Skip restart if DFX healthy
- Check: `dfx ping`, canisters responsive
- Handle stale state: cleanup and restart if needed
- **Auto-proceed** to Step 4

#### Step 4: Canister Deployment (`step-04-deploy.md`)
- **Smart Detection**: Skip if canisters up-to-date
- **Atomic Pattern**: backup ‚Üí deploy ‚Üí verify OR rollback
- Backup: `canister_ids.json.backup.<timestamp>`
- Deploy all canisters: marketplace, user_management, atomic_swap, price_oracle, messaging, dispute, performance_monitor
- Verify ALL canisters deployed, rollback on partial failure
- **Auto-proceed** to Step 5

#### Step 5: Configuration Sync (`step-05-sync-config.md`)
- **Smart Detection**: Skip if .env files already consistent
- Sync canister IDs to: `.env`, `crypto_market/.env`, `crypto_market/.env.local`
- Verify all .env files match
- **Auto-proceed** to Step 6

#### Step 6: Verification (`step-06-verify.md`)
- Verify canister health and status
- Run flutter analyze
- Check for runtime errors
- **Auto-proceed** to Step 7

#### Step 7: Launch (`step-07-launch.md`)
- Launch Flutter app
- Optional: Start SwiftBar dashboard
- Final status report

### 6. Run Configuration (`secrets/run-config.yaml`)

**Environments:**
```yaml
local:     network=local,   flavor=dev,  env_file=.env.dev
staging:   network=ic,      flavor=stg,  env_file=.env.staging
production: network=ic,     flavor=prod, env_file=.env.prod
```

**Canisters to Sync:**
- marketplace, user_management, atomic_swap, price_oracle, messaging, dispute, performance_monitor

**App Config Keys:**
- APP_NAME, JURISDICTION, OAUTH_* , IPFS_*, JWT_*, ENCRYPTION_KEY, SHIPPING_MODE, etc.

### 7. BMAD Framework Structure

**Location:** `/Users/vitaliisimko/workspace/projects/other/crypto_market/_bmad/my-custom-agents/`

**Sub-agents:**
- amos: Adversarial Code Reviewer
- flutter-dev: Business logic, BLoC, data layer (non-UI)
- flutter-dev-ui: UI components, screens
- icp-backend-specialist: Motoko/Rust canisters
- flutter-user-emulator: QA/Testing

**Key Files:**
- `_bmad/my-custom-agents/data/safety-protocol.md` ‚Äî CRITICAL for all agents
- `_bmad/my-custom-agents/data/flutter-rules.md` ‚Äî Flutter best practices
- `_bmad/my-custom-agents/data/flutter-driver-mcp-guide.md` ‚Äî MCP testing rules
- `_bmad/my-custom-agents/data/protocols/autonomous_protocol.md` ‚Äî DR/AR workflow
- `_bmad/my-custom-agents/data/protocols/sub-agent-manifest.yaml` ‚Äî Agent registry
- `_bmad/my-custom-agents/workflows/run/workflow.md` ‚Äî /run entry point
- `_bmad/_memory/run-checkpoint.yaml` ‚Äî State tracking

## Current Status

**Ready for:**
- DR/AR autonomous workflows
- Task delegation to sub-agents
- Safety protocol enforcement
- Flutter/ICP development coordination
- /run deployment workflow execution

**Communication flow:**
–í—ñ—Ç–∞–ª—å–æ–Ω ‚Üí –ë—Ä–æ ‚Üí Flutter Orchestrator ‚Üí Sub-Agents

---
### 8. Auto-Activation System Created (NEW)

**Problem Solved:** No need to manually explain everything after `/new`

**Solution:** Complete auto-activation system

**Components:**
1. **Skill:** `skills/flutter-orchestrator-auto/`
   - `SKILL.md` ‚Äî full auto-activation protocol
   - `scripts/auto-activate.sh` ‚Äî activation sequence
   - `scripts/quick-activate.sh` ‚Äî quick trigger
   - `QUICK_REFERENCE.md` ‚Äî instant recall

2. **BOOTSTRAP.md Updated:**
   - Added "FLUTTER ORCHESTRATOR AUTO-MODE" section
   - Auto-activation after context recovery

3. **Memory Flag:** `memory/FLUTTER_ORCHESTRATOR_AUTO_MODE.md`
   - Indicates auto-mode is ACTIVE
   - Quick access to critical IDs and commands

**How it works:**
```
/new ‚Üí Silence ‚Üí Read BOOTSTRAP.md ‚Üí Memory recovery 
‚Üí AUTO-ACTIVATE flutter-orchestrator ‚Üí Load all safety files 
‚Üí Full status report
```

**Result:** After `/new` I will:
- ‚úÖ Restore context from vector memory
- ‚úÖ Embody flutter-orchestrator persona
- ‚úÖ Know all safety rules
- ‚úÖ Know /run workflow (7 steps)
- ‚úÖ Know 5 sub-agents and how to use them
- ‚úÖ Report: "üéØ Flutter Orchestrator ‚Äî –ü–û–í–ù–ê –ë–û–ô–û–í–ê –ì–û–¢–û–í–ù–Ü–°–¢–¨"

**Commands for user:**
- `/flutter` ‚Äî instant activation
- `/crypto` ‚Äî instant activation
- `/new` ‚Äî automatic full activation

### 9. Handoff Created for Testing

**File:** `memory/HANDOFF-SESSION-20260203-220000.md`

**Purpose:** Save context before testing `/new` auto-activation

**Expected test flow:**
1. User runs `/new`
2. Agent should auto-activate flutter-orchestrator mode
3. Verify all safety files loaded
4. Verify full status report shown

**Cleanup after test:** Delete handoff file

---

## SESSION HANDOFF SYNC

**Created:** 2026-02-03 20:00 UTC  
**Status:** Ready for /new test  
**Auto-activation:** ENABLED

---
*flutter-orchestrator persona active*
