# Story 2.5: Deactivate listing

## Status
Ready for Review

## Dependencies

- 2.1 Create listing

## Story

As a seller, I want to deactivate my listing so it no longer appears in search while keeping the record.

## Acceptance Criteria

1. Given I am the seller, when I deactivate, then the status becomes `cancelled` or `inactive` and it is excluded from search. [Source: docs/architecture/api-specification.md#listing-types]
2. Given a deactivated listing, when I view my listings, then itâ€™s clearly marked inactive. [Source: prd/4-functional-requirements.md#42-trading-functions]

### BDD Scenarios

- Scenario: Deactivate listing
  - Given I own the listing
  - When I toggle Deactivate
  - Then status updates and listing disappears from search

## Tasks / Subtasks

- [ ] Frontend: Deactivate control (AC: 1)
  - [ ] Add control on listing detail/manage screen. [Source: docs/architecture/frontend-architecture.md#flutter-app-structure]
  - [ ] File paths: `lib/features/market/screens/listing_detail_screen.dart`, provider `lib/features/market/providers/listing_provider.dart`.

- [ ] Service integration (AC: 1)
  - [ ] Call `updateListing` to set status to cancelled/inactive. [Source: docs/architecture/api-specification.md#marketplace-canister]
  - [ ] Remove from search results via index update.

- [ ] Backend (AC: 1)
  - [ ] Enforce ownership and update indexes to exclude from search. [Source: docs/architecture/backend-architecture.md#canister-based-service-architecture]

## Testing

- Widget tests:
  - Deactivate control visible for owner; toggling updates UI state and disables search visibility.
  - Non-owner cannot see or trigger deactivate.
- Canister unit tests:
  - Ownership enforcement on `updateListing` for status change.
  - Index exclusion verified after status becomes inactive/cancelled.

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| YYYY-MM-DD | 0.2 | Added file paths, service notes, and testing guidance | Scrum Master |


