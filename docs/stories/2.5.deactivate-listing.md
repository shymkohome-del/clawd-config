# Story 2.5: Deactivate listing

## Status
Review

## Dependencies

- 2.1 Create listing

## Story

As a seller, I want to deactivate my listing so it no longer appears in search while keeping the record.

## Acceptance Criteria

1. Given I am the seller, when I deactivate, then the status becomes `cancelled` or `inactive` and it is excluded from search. [Source: docs/architecture/api-specification.md#listing-types]
2. Given a deactivated listing, when I view my listings, then itâ€™s clearly marked inactive. [Source: prd/4-functional-requirements.md#42-trading-functions]

### BDD Scenarios

- Scenario: Deactivate listing
  - Given I own the listing
  - When I toggle Deactivate
  - Then status updates and listing disappears from search

## Tasks / Subtasks

- [ ] Frontend: Deactivation UI (AC: 1)
  - [ ] Add deactivation button/menu option on listing detail and management screens. [Source: architecture/frontend-architecture.md#flutter-app-structure]
  - [ ] Implement confirmation dialog and reason selection. [Source: architecture/frontend-architecture.md#state-management-architecture]
  - [ ] Update listing status in UI state and refresh views. [Source: architecture/frontend-architecture.md#state-management-architecture]
  - [ ] **Localization: Implement multi-language support for deactivation confirmations, reason options, success messages, and status change notifications.**
  - [ ] **Logging: Implement debug logging for listing deactivation attempts, status change operations, reason selections, confirmation dialogs, and search index updates. Ensure logging is disabled in production flavors and only active in development/staging builds.**

- [ ] Service integration (AC: 1)
  - [ ] Call `updateListing` to set status to cancelled/inactive. [Source: docs/architecture/api-specification.md#marketplace-canister]
  - [ ] Remove from search results via index update.

- [ ] Backend (AC: 1)
  - [ ] Enforce ownership and update indexes to exclude from search. [Source: docs/architecture/backend-architecture.md#canister-based-service-architecture]

## Testing

- Widget tests:
  - Deactivate control visible for owner; toggling updates UI state and disables search visibility.
  - Non-owner cannot see or trigger deactivate.
- Canister unit tests:
  - Ownership enforcement on `updateListing` for status change.
  - Index exclusion verified after status becomes inactive/cancelled.

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| YYYY-MM-DD | 0.2 | Added file paths, service notes, and testing guidance | Scrum Master |


