# Story 3.4: Cancel swap before commit

## Status
Review

## Dependencies

- 3.1 Initiate swap (HTLC)

## Story

As a buyer, I want to cancel a swap before any funds are locked so I can back out safely.

## Acceptance Criteria

1. Given a swap draft not yet committed on-chain, when I cancel, then no escrow is created and no funds are locked. [Source: architecture/core-workflows.md#atomic-swap-flow]
2. Given a committed swap, when I try to cancel via this path, then I’m instructed to refund instead. [Source: architecture/api-specification.md#atomic-swap-canister]

### BDD Scenarios

- Scenario: Cancel draft
  - Given I am on the confirm screen
  - When I cancel
  - Then the draft clears and no on-chain action occurs

- Scenario: Attempt cancel after commit
  - Given I already initiated on-chain
  - When I cancel
  - Then I’m directed to refund path

## Tasks / Subtasks

- [ ] Frontend: Cancel UI (AC: 1)
  - [ ] Add cancel option during negotiation phase before HTLC setup. [Source: architecture/frontend-architecture.md#flutter-app-structure]
  - [ ] Show confirmation dialog with cancel reason selection. [Source: architecture/frontend-architecture.md#state-management-architecture]
  - [ ] **Localization: Implement multi-language support for cancellation confirmations, reason selection options, and cancellation notifications to both parties.**

- [ ] Testing (AC: 1, 2)
  - [ ] Integration test for cancel vs refund branch. [Source: architecture/testing-strategy.md#test-organization]

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| YYYY-MM-DD | 0.1 | Initial draft created for Story 3.4 | Scrum Master |


