# Story 2.2: Search and filter listings

## Status
Review

## Dependencies

- 0.5 ICP service layer bootstrap
- 0.6 Logging & error handling baseline
- 0.8 Security baseline
- 1.1 Register with email/social
- 2.1 Create listing

## Story

As a buyer, I want to search and filter listings by category, price range, and location so I can find relevant offers quickly.

## Acceptance Criteria

1. Given listings exist, when I search by text or filter by category/price/location, then I see a paginated list of matching results. [Source: prd/4-functional-requirements.md#42-trading-functions]
2. Given I select filters, when I clear them, then results reset to all active listings. [Source: architecture/backend-architecture.md#canister-based-service-architecture]

### BDD Scenarios

- Scenario: Keyword search
  - Given active listings exist
  - When I enter a keyword
  - Then results show only listings matching the keyword

- Scenario: Filter by price range and category
  - Given listings across categories and prices exist
  - When I set a category and min/max price
  - Then results show only those matching filters

- Scenario: Clear filters
  - Given filters are applied
  - When I tap Clear
  - Then all active listings are shown

## Tasks / Subtasks

- [ ] Frontend: Search UI and filter controls (AC: 1, 2)
  - [ ] Add search bar and filter sheet (category, price range, location). [Source: architecture/frontend-architecture.md#flutter-app-structure]
  - [ ] Implement provider for query state and pagination. [Source: architecture/frontend-architecture.md#state-management-architecture]

- [ ] Frontend: Service integration (AC: 1)
  - [ ] Call `getListings(query, category, minPrice, maxPrice, limit)` with parameters. [Source: architecture/api-specification.md#marketplace-canister]
  - [ ] Handle paging (limit/offset or cursor) on UI side. [Source: architecture/frontend-architecture.md#frontend-services-layer]

- [ ] Backend: Ensure Marketplace search/filter supported (AC: 1)
  - [ ] Implement/confirm filter logic in canister query functions. [Source: architecture/backend-architecture.md#canister-based-service-architecture]

- [ ] Testing (AC: 1, 2)
  - [ ] Widget tests for search/filter UI and empty states. [Source: architecture/testing-strategy.md#test-organization]
  - [ ] Canister unit tests for search/filter logic. [Source: architecture/testing-strategy.md#test-organization]

## Dev Notes

### Data Models

- Listing fields used in filters: `category`, `priceUSD`, `location`, `status`. [Source: architecture/data-models.md#listing-model]

### APIs

- `getListings(query: ?Text, category: ?Text, minPrice: ?Nat64, maxPrice: ?Nat64, limit: ?Nat)` [Source: architecture/api-specification.md#marketplace-canister]

### Structure and Workflows

 - UI in `lib/features/market/screens/home_screen.dart`, filters in shared widgets; service via ICP layer. [Source: architecture/frontend-architecture.md#frontend-services-layer]

## Testing

- Verify:
  - Keyword, category, and price filters combine correctly
  - Clearing filters resets the query
  - Pagination works with more than one page of results

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| YYYY-MM-DD | 0.1 | Initial draft created for Story 2.2 | Scrum Master |

## Dev Agent Record

- Agent Model Used: _TBD_
- Debug Log References: _TBD_
- Completion Notes List: _TBD_
- File List: _TBD_

## QA Results

_TBD_


