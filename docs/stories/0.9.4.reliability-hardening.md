Title: Story 0.9.4 — Reliability hardening
Status: InProgress

# Story 0.9.4: Reliability hardening

## Story

As a repo maintainer, I want retries, error taxonomy, and clear observability so that transient GitHub API issues self‑heal and decisions are traceable.

## Acceptance Criteria

1. Retries with exponential backoff are applied to REST/GraphQL calls on 5xx/timeouts and rate‑limit responses; respect `Retry-After` when provided.
2. Concurrency guard remains: `concurrency.group: ${{ github.workflow }}-${{ github.ref }}`.
3. Errors are categorized with clear messages: unsupported branch, story not Done, PR already exists, missing permissions, repo setting blocks, API transient failure.
4. Observability: group related logs using `::group::/::endgroup::`, emit a final job summary listing key decisions, and annotate common misconfigurations.

## Dependencies

- 0.9.3 Auto‑merge that actually merges

## Tasks / Subtasks

- [ ] Add a reusable bash retry helper with backoff for `curl` calls; detect status codes and rate limit headers.
- [ ] Keep/verify the existing concurrency group.
- [ ] Normalize error messages and reasons into a small taxonomy; output as both logs and job summary.
- [ ] Add GitHub annotations (`::notice`, `::warning`, `::error`) for misconfigurations.

## BDD Scenarios

- Scenario: Transient API failure recovers
  - Given GitHub API returns 502 once
  - When the workflow retries
  - Then the call succeeds and the run continues

## Testing

- Inject a simulated 502 in a dry‑run and verify retry/backoff behavior; confirm summary includes decisions.

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| YYYY‑MM‑DD | 0.1 | Initial draft | Scrum Master |
| 2025-08-19 | 0.2 | QA: Sync — Status remains InProgress; AC1/AC3/AC4 Partial, AC2 Pass. | QA |
| 2025-08-19 | 0.3 | QA: Updated — Added `scripts/retry.sh` helper (generic backoff); concurrency confirmed; taxonomy/summary still partial. Status InProgress. | QA |

## Dev Agent Record

- Current state:
  - Concurrency guard present in workflows
  - Basic retry-by-loop present in `merge-on-green-fallback.yml` for check-run polling; no generic reusable backoff helper yet
  - Decision taxonomy/annotations minimal; some notices/errors in `pr-lint.yml`
  - Metrics summary present in fallback with merge decision; needs expansion

## QA Results

- AC1 — Retries/backoff: Partial. `scripts/retry.sh` provides reusable backoff; pending adoption in API call sites.
- AC2 — Concurrency guard: Pass. Concurrency configured across workflows.
- AC3 — Error taxonomy/messages: Partial. Reasons logged; taxonomy not standardized repo-wide.
- AC4 — Observability/summary: Partial. Minimal groupings and summary; annotations limited.

Verdict: Keep `Status: InProgress`. Next: add reusable backoff helper, unify taxonomy, expand grouped logs and summaries.


