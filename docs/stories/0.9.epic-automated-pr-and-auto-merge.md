Title: Epic 0.9 — Fully automated, reliable PR creation and auto‑merge flow
Status: InProgress

# Epic 0.9: Fully automated, reliable PR creation and auto‑merge flow

## Goal

Create a zero‑touch workflow that opens PRs to `develop`, gates on status/branch rules, enables auto‑merge reliably, and is idempotent, observable, and testable.

## Non‑goals

- Release pipelines
- Build distribution

## Phases

1. Phase 0 — Stabilize and make failures impossible to miss (`0.9.1`)
2. Phase 1 — Deterministic PR creation (no gh CLI) (`0.9.2`)
3. Phase 2 — Auto‑merge that actually merges (`0.9.3`)
4. Phase 3 — Reliability hardening (`0.9.4`)
5. Phase 4 — Reusable and testable design (`0.9.5`)
6. Phase 5 — Policy and docs (`0.9.6`)
7. Phase 6 — Guardrails and quality gates (`0.9.7`)
8. Phase 7 — Cleanup and metrics (`0.9.8`)

## Story

As a repo maintainer, I want our PR automation to be deterministic, resilient, and safe so that contributors get fast feedback and merges happen automatically when policies are satisfied.

## Acceptance Criteria (Epic)

1. All phase stories `0.9.1`–`0.9.8` are Delivered and validated by QA.
2. A successful demo shows: linting blocks bad YAML, deterministic PR creation without duplicates, auto‑merge enabled and executed when checks pass, retries/backoff for transient failures, reusable workflow + self‑tests, documented policies, guardrails for branch/title/story presence, and post‑merge cleanup + metrics.

## Dependencies

- 0.1 Repo & CI baseline

## BDD Scenarios (Epic)

- Scenario: Zero‑touch PR lifecycle
  - Given a push to a valid branch (`feature/*` or `story/*` with `Status: Done`)
  - When the automation runs
  - Then a PR is created or reused deterministically, auto‑merge is enabled, and the PR merges when required checks pass

## Tasks / Subtasks

- [ ] Deliver phase `0.9.1` — Workflow lint + flags
- [ ] Deliver phase `0.9.2` — Deterministic PR creation (no gh)
- [ ] Deliver phase `0.9.3` — Auto‑merge enablement + repo settings alignment
- [ ] Deliver phase `0.9.4` — Retries/backoff, error taxonomy, observability
- [ ] Deliver phase `0.9.5` — Reusable workflow and self‑tests
- [ ] Deliver phase `0.9.6` — CODEOWNERS, docs, PR template
- [ ] Deliver phase `0.9.7` — Guardrails and quality gates
- [ ] Deliver phase `0.9.8` — Post‑merge cleanup and metrics

## Dev Notes

- The operating workflow today is `.github/workflows/auto-pr-from-qa.yml`. Changes should maintain idempotency and backward compatibility while flags are off.
- Prefer REST/GraphQL calls over `gh` to avoid runner dependencies.
 - Legacy `.github/workflows/ci-auto-pr.yml` has been removed; REST/GraphQL-only path remains.

## Testing

- End‑to‑end demo on a test repo branch shows: deterministic PR creation → auto‑merge scheduled → merge on green → branch cleanup → metrics summary.

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| YYYY‑MM‑DD | 0.1 | Initial epic draft from PR automation plan | Scrum Master |
| 2025-08-19 | 0.2 | QA: Sync — Updated phase outcomes; removed legacy GH CLI note; Phase 1 marked Pass. | QA |
| 2025-08-19 | 0.3 | QA: Updated — Phase 4 now Partial (reusable + self-tests present); Phase 5 Partial (CODEOWNERS/PR template added); others unchanged. Epic remains InProgress. | QA |

## QA Results

- Phase 0 (0.9.1): Pass. Linting and flags delivered; required checks enforced in branch protection.
- Phase 1 (0.9.2): Pass. REST-only path implemented; legacy GH CLI workflow removed.
- Phase 2 (0.9.3): Partial. Fallback merge-on-green merges; GraphQL auto-merge blocked by repo settings.
- Phase 3 (0.9.4): Partial. Basic polling/backoff present; taxonomy/summary incomplete.
- Phase 4 (0.9.5): Partial. Reusable workflow and self-tests added; wrapper not thin; local preflight missing.
- Phase 5 (0.9.6): Partial. CODEOWNERS and PR template added; docs update pending.
- Phase 6 (0.9.7): Pass. Guardrails implemented and validated.
- Phase 7 (0.9.8): Partial. Cleanup present; metrics minimal.

Verdict: Keep Epic `Status: InProgress`. Next: retire legacy GH CLI workflow, enable repo auto-merge or rely on fallback, add retries/observability, extract reusable workflow, and add policy files/docs.

## Dev Agent Record

- Current state by phase:
  - 0.9.1: Lint jobs and flags implemented; required-check toggle blocked by plan
  - 0.9.2: Deterministic PR creation implemented and validated; legacy gh workflow removed
  - 0.9.3: Fallback merge-on-green implemented; repo auto-merge setting blocked
  - 0.9.4: Reliability hardening not yet implemented (retry/taxonomy/summary pending)
  - 0.9.5: Reusable extraction and self-tests pending
  - 0.9.6: PR template, CODEOWNERS, and responsibilities docs added; one doc update pending
  - 0.9.7: Title/story checks and labeler added; optional title status rule pending
  - 0.9.8: Branch cleanup active; metrics summary minimal, expansion pending


