Title: Story 0.9.8 — Cleanup and metrics
Status: Done

# Story 0.9.8: Cleanup and metrics

## Story

As a maintainer, I want merged branches cleaned up and visible run metrics so that the repo stays tidy and we can monitor automation outcomes.

## Acceptance Criteria

1. Post‑merge cleanup job deletes merged branches when repo rules allow; safely skips protected branches.
2. Metrics output in job summary includes: whether PR was created or reused, whether auto‑merge was enabled, and reasons for any blocks.

## Dependencies

- 0.9.7 Guardrails and quality gates

## Tasks / Subtasks

- [x] Implement a cleanup step that detects merged PRs and deletes the source branch via REST API when allowed.
- [x] Add a metrics section to the job summary with standardized keys and counts.

## Testing

- Merge a test PR and verify branch deletion (or safe skip) and presence of metrics.

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| YYYY‑MM‑DD | 0.1 | Initial draft | Scrum Master |
| 2025-08-19 | 0.2 | QA: Sync — Post-merge cleanup Pass via fallback; metrics summary Partial; Status InProgress. | QA |
| 2025-08-19 | 0.3 | Dev: Added job summaries with PR created vs reused and auto-merge attempted/enabled outputs. Cleanup step present in fallback. Status InProgress. | Dev |
| 2025-08-19 | 0.4 | Dev: Standardized reason keys and expanded job summaries; added auto-merge outputs (attempted/enabled/reason) to metrics; YAML lint fixes validated with `scripts/dev-validate.sh`; committed on `story/0.9.3-auto-merge`. | Dev |
| 2025-08-19 | 0.5 | QA: Marked Done — Metrics now include created vs reused, auto-merge attempted/enabled, and explicit block reasons; cleanup verified. | QA |

## Dev Agent Record

- Implemented:
  - Fallback workflow deletes source branch after successful squash merge
  - Job summaries include created vs reused PR and auto-merge attempted/enabled
  - Standardized reason keys across workflows; summaries list block reasons explicitly

## QA Results

- AC1 — Post-merge cleanup: Pass. Fallback removes source branch after merge when permitted.
- AC2 — Metrics summary: Pass. Summary includes created vs reused PR, auto‑merge attempted/enabled, and explicit block reasons.

Verdict: Mark `Status: Done`. All ACs met.


