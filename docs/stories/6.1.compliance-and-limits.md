# Story 6.1: Compliance limits and optional KYC

## Status
Review

## Dependencies

- 0.5 ICP service layer bootstrap
- 0.7 Auth skeleton (UI-only)
- 0.6 Logging & error handling baseline
- 0.8 Security baseline
- 1.1 Register with email/social

## Story

As a platform, we need to apply tiered trading limits and optional KYC so that we meet compliance requirements while enabling growth.

## Acceptance Criteria

1. Given I am authenticated, when I trade without KYC, then tier-0 limits are enforced. [Source: prd/4a-epics-and-capabilities.md#epic-e6-compliance-&-limits]
2. Given I complete KYC, when I trade, then tier-1/2 limits apply per configuration. [Source: prd/4-functional-requirements.md#41-user-management]

### BDD Scenarios

- Scenario: Enforce non-KYC limits
  - Given I have not completed KYC
  - When I try to initiate a large swap
  - Then I am blocked with a message explaining the limit

- Scenario: Apply KYC and increase limits
  - Given I have completed KYC
  - When I initiate the same swap
  - Then it proceeds if within my tier limit

## Tasks / Subtasks

- [ ] Frontend: Limits UI and messaging (AC: 1, 2)
  - [ ] Show current tier and remaining limits in profile. [Source: architecture/frontend-architecture.md#flutter-app-structure]

- [ ] Frontend: KYC entry (AC: 2)
  - [ ] Add KYC submission flow (stub for MVP if off-chain). [Source: prd/4-functional-requirements.md#41-user-management]

- [ ] Backend/Service integration (AC: 1, 2)
  - [ ] Expose/read limits per user in user management service; enforce in canisters where relevant. [Source: architecture/backend-architecture.md#authentication-architecture]

- [ ] Security & Observability (AC: 1, 2)
  - [ ] Principal validation, input validation, logging of limit checks. [Source: architecture/coding-standards.md#critical-fullstack-rules] [Source: architecture/monitoring-and-observability.md#key-metrics]

- [ ] Testing (AC: 1, 2)
  - [ ] Tests for limit enforcement and KYC flow gating. [Source: architecture/testing-strategy.md#test-organization]

- [ ] **Localization: Implement multi-language support for tier status labels, limit notification messages, KYC form fields, validation messages, and compliance-related user prompts.**

## Dev Notes

### Data Models

- User fields include `kycVerified` and can include limit tier metadata. [Source: architecture/data-models.md#user-model]

### APIs

- `verifyKYC(kycData)` and related profile updates. [Source: architecture/api-specification.md#user-management-canister]

### Structure and Workflows

- Profile and trading flows must check limits before initiating swaps. [Source: architecture/core-workflows.md#atomic-swap-flow]

## Testing

- Verify:
  - Non-KYC users blocked on exceeding limits
  - KYC users permitted within configured limits

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| YYYY-MM-DD | 0.1 | Initial draft created for Story 6.1 | Scrum Master |

## Dev Agent Record

- Agent Model Used: _TBD_
- Debug Log References: _TBD_
- Completion Notes List: _TBD_
- File List: _TBD_

## QA Results

_TBD_


