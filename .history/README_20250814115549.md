# Crypto Market

![Flutter CI](https://github.com/Vatalion/crypto_market/actions/workflows/flutter-ci.yml/badge.svg?branch=main)

Repository baseline for a Flutter application with CI.

## Commit Style

Follow Conventional Commits:

- feat: add a new feature
- fix: fix a bug
- docs: documentation only changes
- style: formatting, missing semi colons, etc.; no code change
- refactor: code change that neither fixes a bug nor adds a feature
- test: add or fix tests
- chore: maintenance tasks (build, deps, tooling)

Examples:

- feat(auth): add email sign-up flow
- fix(market): handle null price feed

## Branching

- main: production branch, protected, always green
- develop: integration branch; open PRs from feature branches into `develop`
- feature/<short-topic>: feature work (e.g., feature/market-search)
- fix/<short-topic>: bug fixes
- chore/<short-topic>: maintenance/tooling

Open PRs from feature/fix/chore branches into `develop`. For release, open a PR from `develop` to `main`. CI must pass (analyze, format check, tests) before merge.

## CI

Workflow file: `.github/workflows/flutter-ci.yml` (name: Flutter CI). Triggers on PRs to `main` and runs:

- flutter pub get
- flutter analyze --fatal-infos --fatal-warnings
- dart format --output=none --set-exit-if-changed .
- flutter test

Caching: Flutter SDK and pub packages (`~/.pub-cache`).


## Configuration (Story 0.3)

The app reads configuration from `--dart-define` values at build/run time. A template of required keys is provided in `.env.example` (do not commit secrets).

- Required keys:
  - OAuth: `OAUTH_GOOGLE_CLIENT_ID`, `OAUTH_GOOGLE_CLIENT_SECRET`, `OAUTH_APPLE_TEAM_ID`, `OAUTH_APPLE_KEY_ID`
  - IPFS: `IPFS_NODE_URL`, `IPFS_GATEWAY_URL`
  - Canisters: `CANISTER_ID_MARKETPLACE`, `CANISTER_ID_USER_MANAGEMENT`, `CANISTER_ID_ATOMIC_SWAP`, `CANISTER_ID_PRICE_ORACLE`
  - Optional: `CHAINLINK_API_KEY`, `COINGECKO_API_KEY`, `KYC_PROVIDER_API_KEY`

- Precedence: `--dart-define` overrides any local `.env` usage and defaults. Secrets are never committed.

- Run example (development):
  - iOS/Android/web (from `crypto_market/` directory):
    ```bash
    flutter run \
      --dart-define=OAUTH_GOOGLE_CLIENT_ID=xxx \
      --dart-define=OAUTH_GOOGLE_CLIENT_SECRET=xxx \
      --dart-define=OAUTH_APPLE_TEAM_ID=xxx \
      --dart-define=OAUTH_APPLE_KEY_ID=xxx \
      --dart-define=IPFS_NODE_URL=https://ipfs.local \
      --dart-define=IPFS_GATEWAY_URL=https://gateway.local \
      --dart-define=CANISTER_ID_MARKETPLACE=aaaaa-aa \
      --dart-define=CANISTER_ID_USER_MANAGEMENT=bbbbb-bb \
      --dart-define=CANISTER_ID_ATOMIC_SWAP=ccccc-cc \
      --dart-define=CANISTER_ID_PRICE_ORACLE=ddddd-dd
    ```

- Error behavior: If a required key is missing, the app shows: `Missing required config: <KEY>` and does not crash.

- Rotation guidance: Store secrets in your CI/CD secret store (e.g., GitHub Actions secrets). Rotate credentials on schedule or on compromise, and redeploy with updated `--dart-define` values.

