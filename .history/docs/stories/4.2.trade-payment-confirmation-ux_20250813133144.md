# Story 4.2: Trade payment confirmation UX

## Status
Ready for Review

## Dependencies

- 4.1 Payment method capture & confirmation
- 3.1 Initiate swap (HTLC)

## Story

As a seller, I want a clear confirmation step for payment received so that the buyer can safely complete the swap.

## Acceptance Criteria

1. Given an active swap, when I confirm payment, then the swap state is updated and buyer can complete. [Source: prd/4-functional-requirements.md#42-trading-functions]
2. Given I tap confirm by mistake, when I cancel, then no state change occurs. [Source: architecture/error-handling-strategy.md#error-flow]

### BDD Scenarios

- Scenario: Confirm payment
  - Given an active swap
  - When I tap Payment received and confirm
  - Then the swap state reflects seller confirmation

- Scenario: Cancel confirmation
  - Given I opened the confirm dialog
  - When I cancel
  - Then nothing changes

## Tasks / Subtasks

- [ ] Frontend: Confirmation UI (AC: 1, 2)
  - [ ] Add explicit confirmation dialog and audit notes. [Source: architecture/frontend-architecture.md#flutter-app-structure]

- [ ] Service integration (AC: 1)
  - [ ] Update swap metadata/state to gate buyer completion. [Source: architecture/core-workflows.md#atomic-swap-flow]

- [ ] Testing (AC: 1, 2)
  - [ ] Widget tests for dialog, state change, and cancel path. [Source: architecture/testing-strategy.md#test-organization]

## Dev Notes

- Ensure clear messaging and audit-friendly logs for confirmation events. [Source: architecture/monitoring-and-observability.md#key-metrics]

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| YYYY-MM-DD | 0.1 | Initial draft created for Story 4.2 | Scrum Master |

## Dev Agent Record

- Agent Model Used: _TBD_
- Debug Log References: _TBD_
- Completion Notes List: _TBD_
- File List: _TBD_

## QA Results

_TBD_


