# Story 0.3: Config & secrets

## Status
Needs Revision

## Dependencies

- 0.1 Repo & CI baseline

## Story

As a developer, I want a clear config/secrets structure (.env.example and loaders), so that OAuth, IPFS, and canister IDs can be configured safely without code changes.

## Acceptance Criteria

1. `.env.example` lists required variables:
   - OAuth: `OAUTH_GOOGLE_CLIENT_ID`, `OAUTH_GOOGLE_CLIENT_SECRET`, `OAUTH_APPLE_TEAM_ID`, `OAUTH_APPLE_KEY_ID`
   - IPFS: `IPFS_NODE_URL`, `IPFS_GATEWAY_URL`
   - Canisters: `CANISTER_ID_MARKETPLACE`, `CANISTER_ID_USER_MANAGEMENT`, `CANISTER_ID_ATOMIC_SWAP`, `CANISTER_ID_PRICE_ORACLE`
   - Price APIs: `CHAINLINK_API_KEY` (optional), `COINGECKO_API_KEY` (optional)
   - KYC: `KYC_PROVIDER_API_KEY` (if applicable)
   [Source: architecture/external-apis.md#ipfs-api] [Source: architecture/external-apis.md#kyc-provider-apis]
2. App loads config via a single config layer at `lib/core/config/app_config.dart` using `--dart-define` or `.env` loader; secrets are not committed. [Source: architecture/coding-standards.md#critical-fullstack-rules]
3. Config keys and usage are documented in `README.md`, including local/dev/prod conventions and rotation strategy. [Source: architecture/tech-stack.md#technology-stack-table]

### BDD Scenarios

- Scenario: App loads with required config
  - Given all required keys are present in the runtime configuration
  - When the app initializes via the config layer
  - Then initialization succeeds and the app does not crash

- Scenario: App surfaces clear error when a required key is missing
  - Given one or more required keys are missing
  - When the app initializes
  - Then a clear error state is shown: "Missing required config: <KEY>" and the app does not crash

## Tasks / Subtasks

- [ ] Create/update `.env.example` with exact keys above. (AC: 1) [Source: architecture/external-apis.md]
- [ ] Implement `lib/core/config/app_config.dart` and reference from ICP service. (AC: 2) [Source: architecture/frontend-architecture.md#frontend-services-layer]
- [ ] Document config variables and rotation strategy in `README.md` (include `--dart-define`). (AC: 3)

## Dev Notes

- Tech selection implies multiple external APIs (KYC, Chainlink, CoinGecko, IPFS); list their keys/URLs explicitly. [Source: architecture/external-apis.md]
- Avoid direct environment access; use config objects. [Source: architecture/coding-standards.md#critical-fullstack-rules]

## Testing

- Smoke test: with required keys present app initializes; if missing, app surfaces a clear error state: "Missing required config: <KEY>" and does not crash. [Source: architecture/coding-standards.md#critical-fullstack-rules]

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| YYYY-MM-DD | 0.1 | Initial draft for config/secrets | Scrum Master |

## Dev Agent Record

- Agent Model Used: _TBD_
- Debug Log References: _TBD_
- Completion Notes List: _TBD_
- File List: _TBD_

## QA Results

- Evidence missing for `lib/core/config/app_config.dart` and `.env.example` in repo. Update once implemented.


