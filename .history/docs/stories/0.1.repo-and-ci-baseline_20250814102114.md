# Story 0.1: Repo & CI baseline

## Status
Accepted

## Dependencies

None

## Story

As a developer, I want a consistent repo setup with automated CI (build, lint, test), so that every change is validated and quality remains high.

## Acceptance Criteria

1. CI workflow file exists at `.github/workflows/flutter-ci.yml` and triggers on PRs to `main`. [Source: architecture/unified-project-structure.md#monorepo-structure]
2. CI runs steps: `flutter pub get`, `flutter analyze --fatal-infos --fatal-warnings`, `dart format --output=none --set-exit-if-changed .`, and `flutter test`; any failure blocks merge. [Source: architecture/testing-strategy.md#test-organization] [Source: architecture/coding-standards.md#critical-fullstack-rules]
3. CI caches Flutter SDK and pub packages to reduce build time. [Source: architecture/testing-strategy.md#test-organization]
4. Commit style and branching conventions are documented in `README.md` (e.g., Conventional Commits, feature/* branches). [Source: architecture/coding-standards.md#naming-conventions]
5. CI status badge is added to `README.md` and reflects the workflow name. [Source: architecture/testing-strategy.md#test-organization]

### BDD Scenarios

- Scenario: CI runs on PR and blocks merge on failure
  - Given a pull request is opened against `main`
  - When the CI workflow runs analyze, format check, and tests
  - Then any failure blocks merging and the CI badge reflects failing status

## Tasks / Subtasks

- [x] Create `.github/workflows/flutter-ci.yml` with PR trigger to `main`. (AC: 1)
- [x] Add steps: `flutter pub get`, `flutter analyze --fatal-infos --fatal-warnings`, `dart format --output=none --set-exit-if-changed .`, `flutter test`. (AC: 2)
- [x] Configure caching for `~/.pub-cache` and Flutter SDK. (AC: 3)
- [x] Document commit/branching conventions in `README.md`. (AC: 4)
- [x] Add CI badge to `README.md` (workflow name: Flutter CI). (AC: 5)

## Dev Notes

 - Use Testing Strategy structure to ensure tests run predictably in CI. [Source: docs/architecture/testing-strategy.md#test-organization]
 - Enforce coding standards (Result handling, validation conventions) via analyzer rules. [Source: docs/architecture/coding-standards.md#critical-fullstack-rules]
 - Place workflows under `.github/workflows/flutter-ci.yml` (standardized to match badge and ACs). [Source: docs/architecture/unified-project-structure.md#monorepo-structure]

## Testing

- CI run shows: analyze=0 errors, format check=0 changes, tests=passing. Add badge visible on repo home. [Source: architecture/testing-strategy.md#test-examples]

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| YYYY-MM-DD | 0.1 | Initial draft for CI baseline | Scrum Master |

## Dev Agent Record

- Agent Model Used: GPT-5 (Cursor)
- Debug Log References: Ran `flutter pub get`, `dart format --set-exit-if-changed`, `flutter analyze --fatal-infos --fatal-warnings`, `flutter test --no-pub` locally; fixed missing import and removed invalid dependency.
- Completion Notes List:
  - CI workflow added with caching and required steps
  - README updated with badge and conventions
  - Local validation all green
- File List:
  - `.github/workflows/flutter-ci.yml` (new)
  - `README.md` (new at repo root)
  - `crypto_market/lib/core/network/dio_client.dart` (edit: fixed import path)
  - `crypto_market/pubspec.yaml` (edit: removed invalid dependency)

## QA Results

- Review Date: 2025-08-08
- Reviewer: Quinn (Senior Developer & QA Architect)

- Findings by Acceptance Criteria:
  - AC1 (workflow exists and triggers on PRs to main): Met. Workflow added at `.github/workflows/flutter-ci.yml` with PR trigger to `main` (and `develop`) and manual `workflow_dispatch`.
  - AC2 (required steps run, failures block merge): Met. Workflow runs `flutter pub get`, `flutter analyze --fatal-infos --fatal-warnings`, `dart format --output=none --set-exit-if-changed .`, and `flutter test --no-pub`. Default GitHub Actions failure behavior blocks merge when steps fail.
  - AC3 (caching Flutter SDK and pub packages): Met. Using `subosito/flutter-action@v2` with `cache: true` to cache SDK and pub packages. Steps run in `crypto_market` working directory.
  - AC4 (commit/branching conventions in README): Met. Conventions documented in root `README.md`.
  - AC5 (CI status badge in README): Met. Badge present and targets `actions/workflows/flutter-ci.yml`.

- Risks / Notes:
  - The `Dev Notes` mention placing workflows under `.github/workflows/flutter.yml`, which conflicts with the expected `flutter-ci.yml`. Standardize on `flutter-ci.yml` to match the badge and ACs.
  - If the actual workflow lives only in the remote default branch, ensure it is committed to this workspace as well to keep docs truthful and enable local review.

- Recommendations:
  1) Keep workflow filename aligned with badge (`flutter-ci.yml`).
  2) Consider running on `develop` as well (already enabled) to catch issues earlier.
  3) Optionally add matrix for OS testing if desktop targets are important.

- Provisional Status: Accepted — AC1–AC5 satisfied in repo.


